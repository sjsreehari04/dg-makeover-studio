{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card shadow-lg border-0" id="bill-print">
        <!-- Header -->
        <div class="card-header bg-gradient-primary text-white text-center py-4">
          <h2 class="mb-0">DG Makeover Studio</h2>
          <p class="mb-0">Professional Beauty & Wellness Services</p>
          <small>Invoice #{{ bill.invoice_number }} | Date: {{ bill.created_at|date:"M d, Y" }}</small>
        </div>

        <!-- Bill Details -->
        <div class="card-body p-5">
          <!-- Customer Info -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h5 class="text-primary">Bill To:</h5>
              <p class="mb-1"><strong>{{ bill.consultation.customer.name }}</strong></p>
              <p class="mb-1">{{ bill.consultation.customer.phone }}</p>
              <p class="mb-0">{{ bill.consultation.customer.address }}</p>
            </div>
            <div class="col-md-6 text-md-end">
              <h5 class="text-primary">Consultation Details:</h5>
              <p class="mb-1">Visit Date: {{ bill.consultation.visit_date }}</p>
              <p class="mb-1">Payment Mode: {{ bill.get_payment_mode_display }}</p>
              <p class="mb-0">Generated by: {% if bill.created_by.shop %}{{ bill.created_by.shop.name }}{% else %}{{ bill.created_by.username }}{% endif %}</p>
            </div>
          </div>

          <!-- Services Table -->
          <div class="table-responsive mb-4">
            <table class="table table-bordered">
              <thead class="table-dark">
                <tr>
                  <th>Service</th>
                  <th class="text-end">Rate</th>
                </tr>
              </thead>
              <tbody>
                {% for service in bill.consultation.services.all %}
                <tr>
                  <td>{{ service.service_name }}</td>
                  <td class="text-end">₹{{ service.rate }}</td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="2" class="text-center text-muted">No services selected</td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot class="table-light">
                <tr>
                  <th>Subtotal</th>
                  <td class="text-end"><strong>₹{{ bill.subtotal }}</strong></td>
                </tr>
                {% if bill.discount %}
                <tr>
                  <th>Discount</th>
                  <td class="text-end text-success">-₹{{ bill.discount }}</td>
                </tr>
                {% endif %}
                <tr class="table-primary">
                  <th>Total Amount</th>
                  <td class="text-end fs-5"><strong>₹{{ bill.total_amount }}</strong></td>
                </tr>
              </tfoot>
            </table>
          </div>

          <!-- Footer Message -->
          <div class="text-center mb-4">
            <p class="text-muted mb-0">Thank you for choosing DG Makeover Studio!</p>
            <p class="text-muted mb-0">We appreciate your business and look forward to serving you again.</p>
          </div>

          <!-- Terms -->
          <div class="border-top pt-3">
            <small class="text-muted">
              <strong>Terms & Conditions:</strong> All services are subject to availability. Prices may vary based on specific requirements.
              Payment is due at the time of service. For any queries, please contact us.
            </small>
          </div>
        </div>

        <!-- Footer -->
        <div class="card-footer bg-light text-center py-3">
          <div class="row">
            <div class="col-md-6">
              <a href="{% url 'consultation_detail' bill.consultation.id %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Consultation
              </a>
            </div>
            <div class="col-md-6">
              <button class="btn btn-primary" onclick="window.print()">
                <i class="bi bi-printer"></i> Print Invoice
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
@media print {
  body * {
    visibility: hidden;
  }
  #bill-print, #bill-print * {
    visibility: visible;
  }
  #bill-print {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
  }
  .btn, .card-footer {
    display: none !important;
  }
}
.bg-gradient-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
</style>

{% endblock %}